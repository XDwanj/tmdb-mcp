# Project Brief: TMDB MCP 服务

**项目日期**: 2025-10-10
**版本**: 1.0
**状态**: 初稿

---

## Executive Summary

TMDB MCP 服务是一个基于 Golang 实现的 Model Context Protocol (MCP) 服务器，它将 TMDB（The Movie Database）电影数据库与大型语言模型（LLM）连接起来，使用户能够通过自然语言对话方式查询、探索和管理影视内容。该项目的核心价值在于利用 LLM 作为"超级胶水"，将传统 API 转化为对话式操作接口，解决自建流媒体服务器用户面临的文件管理和内容发现痛点。

**核心问题**: 自建流媒体用户面临文件命名混乱、内容发现困难的实际痛点
**目标市场**: Jellyfin/Emby/Plex 等自建流媒体服务器用户、影视资源管理者
**关键价值**: 智能文件重命名、自然语言内容探索、降低影视数据库使用门槛

---

## Problem Statement

### 当前状态和痛点

自建流媒体服务器（Jellyfin、Emby、Plex）的用户在管理影视资源时面临多重挑战：

1. **文件命名混乱**: 下载的影视文件通常包含复杂的命名格式（如 `The.Irishman.2019.HDR.1080p.WEBRip.X265-MEGABOX.mp4`），流媒体服务器的刮削器无法准确识别，导致元数据匹配失败。

2. **内容发现困难**: 用户在"片荒"时，需要在 TMDB 网站上使用复杂的筛选条件（类型、年份、评分等）才能找到想看的内容，学习成本高。

3. **关联探索效率低**: 想了解某个导演、演员的其他作品时，需要多次页面跳转和手动搜索。

4. **API 使用门槛高**: TMDB 提供了强大的 API，但需要了解端点、参数、认证等技术细节，普通用户无法直接使用。

### 问题的影响

- **时间成本**: 用户花费大量时间手动重命名文件或修复元数据错误
- **体验受损**: 流媒体库混乱，影响观影体验
- **功能浪费**: TMDB 的丰富数据（推荐、趋势、发现）未被充分利用
- **门槛阻碍**: 技术门槛阻止了更多用户享受自建流媒体的乐趣

### 为什么现有解决方案不够好

- **自动刮削器**: 仅依赖文件名模式匹配，遇到复杂命名或非标准格式时失败率高
- **手动工具**: 如 FileBot，需要用户理解规则语法，学习曲线陡峭
- **Web 界面**: TMDB 官网功能强大但操作繁琐，不适合批量处理或快速探索

### 解决的紧迫性

随着自建流媒体生态的快速发展（Jellyfin 用户数持续增长），用户对内容管理效率的需求日益迫切。LLM 技术的成熟为解决这一痛点提供了最佳时机——让机器理解人类意图，用对话代替复杂操作。

---

## Proposed Solution

### 核心概念

TMDB MCP 服务通过 MCP 协议将 TMDB API 暴露给 LLM（如 Claude），使用户能够用自然语言完成以下操作：

- **智能文件重命名**: "帮我把这个文件夹里的电影都重命名成标准格式"
- **对话式内容探索**: "推荐一些2020年后的高分科幻片"
- **关联图谱查询**: "诺兰还拍过什么电影？"
- **个性化推荐**: "我喜欢《盗梦空间》，推荐类似的"

### 关键差异化因素

1. **场景驱动设计**: 不是完整映射 TMDB API，而是从真实痛点出发，精选 6 个核心工具
2. **智能合并策略**: 将 10 个原子 API（4个搜索、3个详情）合并为 2 个统一工具，降低 LLM 认知负担
3. **自动优化**: 详情接口自动追加 credits/videos，减少额外 API 调用
4. **Golang 实现**: 高性能、类型安全，天然支持并发处理

### 为什么这个方案会成功

- **LLM 泛化能力**: 能够从混乱的文件名中提取关键信息（如 "The.Irishman.2019.HDR" → "The Irishman 2019"）
- **自然语言优势**: 用户无需学习 API 参数，用日常语言表达需求
- **MCP 协议成熟**: Anthropic 官方支持，生态快速发展
- **TMDB 数据稳定**: 全球最大的影视数据库，更新及时，免费 API 可用

### 高层次产品愿景

将 TMDB MCP 服务打造成**自建流媒体生态的智能助手**，让用户通过对话完成所有影视数据相关操作，最终成为连接 LLM 与流媒体服务器（Jellyfin/Emby/Plex）的控制中心。

---

## Target Users

### Primary User Segment: 自建流媒体服务器管理员

**人口统计**:
- 年龄: 25-45 岁
- 技术背景: 熟悉基础技术操作（Docker、命令行），但非专业开发者
- 地理分布: 全球（重点：中国、欧美）

**当前行为和工作流**:
- 使用 Jellyfin/Emby/Plex 搭建家庭影院
- 定期下载影视资源并手动整理文件
- 在 TMDB 网站上查找电影信息并手动复制到文件名
- 使用刮削器失败时手动修正元数据

**具体需求和痛点**:
- 需要快速重命名批量文件（每次下载 10-50 个文件）
- 需要快速找到高分新片补充资源库
- 需要了解演员/导演作品以扩展收藏

**目标**:
- 减少文件管理时间（从每次 1 小时降至 5 分钟）
- 提升媒体库质量（元数据准确率 95%+）
- 提升观影体验（快速找到想看的内容）

### Secondary User Segment: 影视数据爱好者

**人口统计**:
- 年龄: 18-35 岁
- 兴趣: 电影、电视剧、影评
- 技术水平: 不等（从普通用户到技术达人）

**具体需求**:
- 快速探索某个导演/演员的作品集
- 发现小众高分影视作品
- 获取基于兴趣的个性化推荐

**目标**:
- 用自然语言快速获取影视信息
- 发现新的观影灵感
- 避免在网站上繁琐的点击和搜索

---

## Goals & Success Metrics

### Business Objectives

- **用户采用**: MVP 发布后 3 个月内获得 500+ 活跃用户
- **社区认可**: 在 r/selfhosted、r/jellyfin 等社区获得正面反馈
- **生态集成**: 被至少 1 个主流流媒体工具或插件集成
- **开源影响力**: GitHub Stars 达到 1000+

### User Success Metrics

- **任务完成率**: 智能文件重命名场景成功率 ≥ 90%
- **查询效率**: 用户通过自然语言查询的平均响应时间 < 3 秒
- **用户留存**: 30 天用户留存率 ≥ 40%
- **满意度**: NPS（净推荐值）≥ 50

### Key Performance Indicators (KPIs)

- **API 调用量**: 日均 API 调用量（反映活跃度）
- **工具使用分布**: 6 个工具的使用频率分布（验证设计合理性）
- **错误率**: API 错误率 < 1%（不含 TMDB 自身错误）
- **性能**: P95 响应时间 < 500ms

---

## MVP Scope

### Core Features (Must Have)

- **搜索工具 (search)**: 统一的搜索接口，支持电影、电视剧、人物、多媒体搜索
  - **必要性**: 智能文件重命名的第一步

- **详情工具 (get_details)**: 获取电影/电视剧/人物的完整信息（自动包含演员表、视频）
  - **必要性**: 获取标准化命名信息的核心工具

- **发现电影工具 (discover_movies)**: 按类型、年份、评分等条件筛选电影
  - **必要性**: 解决"片荒"痛点的主力工具

- **发现电视剧工具 (discover_tv)**: 按条件筛选电视剧
  - **必要性**: 补充电视剧场景

- **趋势工具 (get_trending)**: 获取当前热门内容（日榜/周榜）
  - **必要性**: 快速了解最新热门

- **推荐工具 (get_recommendations)**: 基于指定内容获取推荐列表
  - **必要性**: 个性化推荐场景的基础

- **错误处理和速率限制**: 处理 401/404/429 错误，实现请求队列（40 req/10s）
  - **必要性**: TMDB 免费 API 的强制要求

- **基础配置**: API Key 配置、语言偏好设置
  - **必要性**: 基本运行要求

### Out of Scope for MVP

- 缓存层（本地缓存查询结果）
- 批量文件处理（文件夹级别操作）
- 多语言智能检测
- 与流媒体服务器的直接集成（Jellyfin/Emby/Plex API）
- 字幕匹配与下载
- 用户历史记录和个性化推荐引擎
- Web UI 或独立客户端

### MVP Success Criteria

MVP 被认为成功，如果：
1. 用户能够通过自然语言完成智能文件重命名（测试成功率 ≥ 85%）
2. 6 个核心工具都能正常工作，响应时间合理（< 3 秒）
3. 错误处理机制有效（优雅处理速率限制和 API 错误）
4. 至少 10 个早期用户反馈"这确实解决了我的问题"

---

## Post-MVP Vision

### Phase 2 Features

- **缓存层**: 本地缓存热门查询（如流行电影详情），减少 API 调用，提升响应速度
- **批量文件处理**: 支持文件夹级别的批量重命名，带进度追踪和错误恢复
- **多语言增强**: 智能检测用户语言偏好，自动设置 TMDB language 参数
- **高级筛选 DSL**: 优化 discover 工具的参数理解，让 LLM 能更精准地转换自然语言查询

### Long-term Vision (1-2 年)

- **跨平台流媒体统一管理**: 整合 Jellyfin/Emby/Plex API，实现"一句话管理我的所有影视库"
  - 示例: "把《盗梦空间》添加到我的 Jellyfin 收藏，并下载中文字幕"

- **AI 驱动的个性化推荐引擎**: 基于用户历史观看记录，结合 TMDB 推荐 + LLM 理解，生成深度个性化推荐

- **智能字幕生态**: 结合 TMDB 元数据，自动匹配并下载最佳字幕

### Expansion Opportunities

- **企业版**: 面向视频平台、影视公司提供内容元数据管理服务
- **插件生态**: 为 Jellyfin/Emby/Plex 提供官方插件
- **多数据源整合**: 整合 IMDb、豆瓣等其他影视数据库
- **AI 生成内容**: 自动生成影评摘要、观影指南

---

## Technical Considerations

### Platform Requirements

- **目标平台**: Linux、macOS、Windows（跨平台支持）
- **运行环境**: Standalone 二进制文件（无需额外依赖）+ Docker 镜像
- **MCP 支持**: 通过 stdio 传输（标准 MCP 协议）
- **性能要求**:
  - 启动时间 < 2 秒
  - API 响应时间 < 500ms（P95）
  - 支持并发请求（至多 40 req/10s，受 TMDB 限制）

### Technology Preferences

**Frontend**:
- 无（MVP 阶段仅通过 MCP 协议与 Claude 等 LLM 交互）

**Backend**:
- **语言**: Golang 1.21+
- **MCP SDK**: `github.com/modelcontextprotocol/go-sdk` (官方 Golang SDK)
- **HTTP 客户端**: 标准库 `net/http` 或 `github.com/go-resty/resty`
- **速率限制**: `golang.org/x/time/rate`
- **日志**: `go.uber.org/zap`

**Database**:
- 无（MVP 阶段不需要持久化，未来可考虑 SQLite 存储缓存）

**Hosting/Infrastructure**:
- **部署方式**: 用户本地运行（二进制文件或 Docker 容器）
- **分发**: GitHub Releases（多平台二进制文件）
- **镜像仓库**: Docker Hub

### Architecture Considerations

**Repository Structure**:
- 单体仓库（monorepo）
- 清晰的分层架构：`cmd/`（入口）、`internal/`（业务逻辑）、`pkg/`（可复用包）

**Service Architecture**:
- 单进程服务（通过 stdio 与 MCP 客户端通信）
- 分层设计：
  - MCP 层（处理 MCP 协议）
  - 工具层（6 个 MCP 工具实现）
  - TMDB 客户端层（封装 TMDB API 调用）
  - 速率限制层（请求队列管理）

**Integration Requirements**:
- TMDB API v3（RESTful API）
- MCP 协议（JSON-RPC over stdio）
- 环境变量读取（API Key 配置）

**Security/Compliance**:
- API Key 通过环境变量或配置文件读取（不硬编码）
- 遵守 TMDB API 使用条款（速率限制、归属声明）
- 不存储用户个人信息（MVP 阶段）

---

## Constraints & Assumptions

### Constraints

- **预算**: 无（开源项目，依赖免费服务）
- **时间线**: MVP 计划 3-4 周完成（单人开发，业余时间）
- **资源**: 单人开发（需要社区帮助测试和反馈）
- **技术约束**:
  - TMDB 免费 API 限制：40 requests/10 seconds
  - MCP 协议限制：仅支持 stdio 传输（MVP 阶段）
  - 依赖 LLM 客户端（Claude Code、其他支持 MCP 的客户端）

### Key Assumptions

- 假设目标用户已具备基础技术能力（能安装二进制文件或使用 Docker）
- 假设 TMDB API 保持稳定且免费层级足够使用
- 假设 MCP 协议生态持续发展，有更多客户端支持
- 假设 LLM（如 Claude）能够有效理解和使用 6 个工具
- 假设用户的主要语言是英文或中文（TMDB 对这两种语言支持最好）
- 假设智能文件重命名场景中，文件名包含足够的识别信息（标题、年份）

---

## Risks & Open Questions

### Key Risks

- **LLM 工具理解失败**: 如果 LLM 无法正确理解工具参数（尤其是 discover 的复杂参数），用户体验会大幅下降
  - **影响**: 核心场景失败，用户放弃使用
  - **缓解**: 提供清晰的工具描述和示例，迭代优化参数设计

- **TMDB API 变更或限制**: TMDB 可能修改 API、收紧免费层限制或关闭服务
  - **影响**: 服务完全不可用
  - **缓解**: 监控 TMDB 官方公告，设计多数据源备份方案

- **MCP 协议采用率低**: 如果 MCP 生态发展缓慢，用户群体受限
  - **影响**: 用户量增长缓慢
  - **缓解**: 同时支持其他集成方式（如 REST API、CLI）

- **搜索结果歧义**: 搜索返回多个结果时，LLM 可能选择错误的项（如同名电影）
  - **影响**: 文件重命名错误，用户需手动修正
  - **缓解**: 提供更多上下文信息（年份、评分），引导 LLM 做出正确选择

### Open Questions

- 如何优雅地处理"搜索返回多个结果"的情况？让 LLM 选择还是返回列表让用户确认？
- discover 工具的参数如此复杂，LLM 能否有效利用？是否需要简化或提供参数模板？
- 是否需要提供"获取配置信息"的工具（如支持的语言列表、类型列表）？
- 工具描述的详细程度如何平衡？过于详细会增加 LLM 理解负担，过于简单会导致误用
- 是否应该在 MVP 中包含最基础的缓存（如会话级别的内存缓存）？

### Areas Needing Further Research

- **Golang MCP SDK 学习**: 熟悉 `github.com/modelcontextprotocol/go-sdk` 的使用方式和最佳实践
- **LLM 工具使用模式**: 研究 Claude 等 LLM 如何理解和选择工具，优化工具设计
- **用户测试**: 准备测试文件集和测试场景，收集真实用户反馈
- **TMDB API 细节**: 深入了解图片 URL 构建、多语言支持、错误码含义
- **竞品分析**: 调研是否有类似的 TMDB MCP 实现或其他形式的 TMDB LLM 集成

---

## Appendices

### A. Research Summary

本项目简报基于以下研究和分析：

**头脑风暴会议（2025-10-09）**:
- 使用第一性原理思维方法
- 识别了 10 个原子能力并合并为 6 个 MCP 工具
- 确定了 4 个核心使用场景（智能文件重命名、片荒推荐、关联探索、智能推荐）
- 详细结果见：`docs/brainstorming-session-results.md`

**TMDB API 技术调研**:
- 完成 TMDB API v3 核心接口文档编写
- 确认速率限制（40 req/10s）和认证方式
- 设计 MCP 工具与 API 端点的映射关系
- 详细文档见：`docs/tmdb-api.md`

**关键发现**:
- LLM 的泛化能力非常适合文件名识别场景
- 工具数量比功能完整性更重要（6 个工具是认知负载的甜蜜点）
- 场景驱动设计优于 API 完整映射
- Golang 的高性能和类型安全非常适合实现 MCP 服务

### B. Stakeholder Input

**项目发起人**: 自建流媒体用户（个人需求驱动）
**社区反馈**: 待收集（计划在 r/selfhosted、r/jellyfin 发布 RFC）

### C. References

- [TMDB API 官方文档](https://developers.themoviedb.org/3)
- [MCP 协议规范](https://spec.modelcontextprotocol.io/)
- [Anthropic MCP 文档](https://docs.anthropic.com/claude/docs/model-context-protocol)
- [Jellyfin 官网](https://jellyfin.org/)
- [Golang 官方文档](https://go.dev/doc/)

---

## Next Steps

### Immediate Actions

1. **技术验证**: 学习官方 `github.com/modelcontextprotocol/go-sdk`，编写 Hello World 示例（1 天）
2. **项目初始化**: 搭建 Golang 项目结构，配置开发环境（1 天）
3. **TMDB 客户端实现**: 封装 TMDB API 调用，实现速率限制（3-5 天）
4. **MCP 工具实现**: 逐个实现 6 个 MCP 工具（7-10 天）
5. **集成测试**: 使用真实 API Key 和 Claude 进行端到端测试（2-3 天）
6. **文档编写**: README、安装指南、使用示例（2 天）
7. **社区发布**: GitHub 开源，Reddit/Discord 宣传（1 天）

### PM Handoff

本项目简报提供了 TMDB MCP 服务的完整上下文。接下来，建议产品经理（PM）：

1. **审查并确认方向**: 确认问题定义、解决方案和 MVP 范围是否准确
2. **细化用户故事**: 基于 MVP 功能创建详细的用户故事和验收标准
3. **风险评估**: 与技术团队讨论开放问题，制定风险缓解计划
4. **测试计划**: 设计测试场景和测试数据集（复杂文件名、各种查询类型）
5. **社区策略**: 制定早期用户招募和反馈收集计划

**准备启动 PRD 生成模式**，逐节创建产品需求文档，如有任何疑问请随时提出。

---

*本文档由 Business Analyst Mary 使用 BMAD™ 方法创建*
