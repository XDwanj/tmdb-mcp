# Requirements

## Functional Requirements

1. **FR1**: 系统必须提供统一的搜索工具（search），支持通过自然语言查询电影、电视剧、人物和多媒体内容，并返回匹配结果列表（包括标题、年份、评分等关键信息）

2. **FR2**: 系统必须提供详情获取工具（get_details），能够根据 TMDB ID 获取电影、电视剧或人物的完整信息，并自动追加演职人员表（credits）和相关视频（videos）数据

3. **FR3**: 系统必须提供电影发现工具（discover_movies），支持按类型、年份、评分、语言等条件筛选电影，并返回符合条件的电影列表

4. **FR4**: 系统必须提供电视剧发现工具（discover_tv），支持按类型、首播年份、评分、状态等条件筛选电视剧，并返回符合条件的剧集列表

5. **FR5**: 系统必须提供趋势工具（get_trending），能够获取当前热门的电影、电视剧或人物，支持按日榜（day）或周榜（week）查询

6. **FR6**: 系统必须提供推荐工具（get_recommendations），能够基于指定的电影或电视剧 ID 获取相似内容推荐列表

7. **FR7**: 系统必须实现完整的错误处理机制，能够识别并优雅处理 TMDB API 返回的 401（未授权）、404（未找到）、429（速率限制）等错误，并向用户返回清晰的错误信息

8. **FR8**: 系统必须支持 TMDB API Key 和语言参数的配置管理:
   - API Key 通过环境变量或配置文件读取
   - 语言参数支持**两级优先级**:
     1. **工具级参数**: MCP 工具调用时传入的 `language` 参数(最高优先级)
     2. **配置默认值**: 环境变量/配置文件中的 `language` 设置(未指定时默认 `en-US`)
   - 不实现自动语言检测
   - 所有 MCP 工具必须统一遵循此优先级模型

9. **FR9**: 系统必须支持两种运行模式：
   - **stdio 模式**：通过标准输入/输出与 MCP 客户端通信（遵循 MCP 协议规范）
   - **SSE 模式**：通过 HTTP Server-Sent Events 提供远程访问，默认端口 8910，使用 `Authorization: Bearer <token>` 进行认证
   - 支持同时启用两种模式

10. **FR10**: (已删除 - LLM 负责文件名解析)

11. **FR11**: SSE 模式必须提供以下端点：
    - `GET /mcp/sse` - 建立 MCP over SSE 连接（需要有效的 Bearer token）
    - `GET /health` - 健康检查端点（返回服务状态，无需认证）

## Non-Functional Requirements

1. **NFR1**: API 响应时间的 P95 必须小于 500 毫秒（不包含 TMDB API 自身延迟）

2. **NFR2**: 系统启动时间必须小于 2 秒，确保用户快速开始使用

3. **NFR3**: 系统必须实现速率限制机制，支持通过配置文件或命令行 flags 设置请求速率（默认 40 requests/10 seconds），命令行参数优先级高于配置文件，确保不触发 TMDB API 限流

4. **NFR4**: 系统的 API 调用错误率（不含 TMDB 自身错误）必须小于 1%

5. **NFR5**: 系统必须支持跨平台运行（Linux、macOS、Windows），以独立二进制文件或 Docker 容器形式分发

6. **NFR6**: 系统必须使用 Golang 1.21+ 实现，利用其类型安全和天然并发能力，确保代码质量和性能

7. **NFR7**: 系统必须支持并发处理多个请求，在速率限制范围内最大化吞吐量

8. **NFR8**: 系统日志必须使用结构化日志框架（如 zap），记录关键操作、错误和性能指标，便于调试和监控

9. **NFR9**: 系统配置（API Key、语言偏好、速率限制）必须通过环境变量、配置文件或命令行 flags 管理（优先级：命令行 > 环境变量 > 配置文件），不得在代码中硬编码敏感信息

10. **NFR10**: 系统必须遵守 TMDB API 使用条款，包括在返回数据中保留归属声明和遵守速率限制

11. **NFR11**: SSE 模式的 Token 管理必须满足：
    - 优先使用环境变量 `SSE_TOKEN`（方便 Docker 部署）
    - 其次从配置文件 `~/.tmdb-mcp/config.yaml` 读取
    - 若两者都未设置，首次启动时自动生成 256-bit 随机 token 并持久化到配置文件
    - Token 验证失败时返回 `401 Unauthorized`

12. **NFR12**: 配置文件 `~/.tmdb-mcp/config.yaml` 创建时必须设置权限为 `600`（仅所有者可读写），防止 token 泄露

---
