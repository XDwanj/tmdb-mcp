schema: 1
story: "6.1"
story_title: "故事 6.1：Streamable HTTP 端点与服务集成"
gate: "FAIL" # PASS|CONCERNS|FAIL|WAIVED
status_reason: "缺少会话生命周期日志与异常请求处理细化（AC4/AC5），且测试未实现（AC6）。"
reviewer: "Quinn (Test Architect)"
updated: "2025-10-26T12:45:58Z"

waiver:
  active: false

top_issues:
  - id: "TEST-001"
    severity: high
    finding: "缺少 `/mcp/stream` 的单元测试与最小会话集成测试（AC6）。"
    suggested_action: "使用 httptest + MCP SDK InMemory 传输覆盖成功握手、缺失 Token、非 GET 与 HTTP/1.0 场景，并纳入 go test ./..."
  - id: "OBS-001"
    severity: medium
    finding: "未见 Streamable 会话生命周期（连接/重连/关闭/错误）的结构化日志（AC4）。"
    suggested_action: "在 Streamable handler 外包一层记录事件或通过自定义 handler 钩子打印结构化日志，包含 session_id、addr、event、error。"
  - id: "API-001"
    severity: medium
    finding: "异常请求处理未显式覆盖非 GET 与 HTTP/1.0（AC5）。"
    suggested_action: "在中间件或路由层增加方法与协议版本校验，返回统一 JSON 错误并写安全日志。"

risk_summary:
  totals: { critical: 0, high: 1, medium: 2, low: 0 }
  recommendations:
    must_fix:
      - "补齐测试（TEST-001）"
      - "新增会话生命周期日志（OBS-001）"
      - "完善异常请求显式处理（API-001）"
    monitor: []

